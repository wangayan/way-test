### 2025-08-01 日报  
*** 

- 更新设计表
####  设计表

	1. 用户表（user_info）
	
	设计依据：用于标识访问店铺的用户，为统计访客数、下单买家数等提供用户维度支持
	
	2. 页面基础信息表（page_base_info）
	
	设计依据：区分店铺页、商品详情页、店铺其他页，为页面访问排行提供基础页面属性数据
	
	3. 无线端访问数据表（wireless_access_data）
	
	设计依据：存储无线端进店页面的访客数、下单买家数等数据，支持日 / 7 天 / 月等维度查询
	
	4. 页面访问排行表（page_visit_rank）
	
	设计依据：按访客数对店铺页、商品详情页等进行排行，直接展示页面访问数据排序结果
	
	5. 店内路径流转表（instore_path_flow）
	
	设计依据：记录访客在店内的页面流转路径，体现来源页面与去向页面的关系
	
	6.  PC 端来源数据表（pc_source_data）
	
	设计依据：存储 PC 端访客的来源页面 TOP20 及占比数据，支持来源分析

#### 总结：分析完所有表之后，写一个python脚本生成数据

*** 

- ods层

因为ods层是原始数据层，用seatunnel脚本，从 mysql 中读取数据，生成建表语句和数据，存储在 hdfs 中，然后写进 hive 中。 seatunnel 的模块化设计包括 source 、transform 和 sink

-  dwd层
-
-- 1. DWD用户信息全量表  
CREATE TABLE IF NOT EXISTS gd.dwd_user_info_full(  
user_id STRING COMMENT '用户ID',  
platform_type STRING COMMENT '平台类型(无线端/PC端)',  
first_visit_time TIMESTAMP COMMENT '首次访问时间',  
last_visit_time TIMESTAMP COMMENT '最后访问时间',  
create_time TIMESTAMP COMMENT '创建时间'  
) COMMENT 'DWD层用户信息全量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

-- 2. DWD页面基础信息全量表  
CREATE TABLE IF NOT EXISTS gd.dwd_page_base_info_full(  
page_id STRING COMMENT '页面ID',  
page_type STRING COMMENT '页面类型(店铺页/商品详情页/店铺其他页)',  
page_name STRING COMMENT '页面名称',  
shop_id STRING COMMENT '店铺ID',  
product_id STRING COMMENT '商品ID(仅商品详情页有值)',  
page_create_time TIMESTAMP COMMENT '页面创建时间',  
create_time TIMESTAMP COMMENT '记录创建时间'  
) COMMENT 'DWD层页面基础信息全量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

-- 3. DWD无线端访问数据增量表  
CREATE TABLE IF NOT EXISTS gd.dwd_wireless_access_data_inc(  
id BIGINT COMMENT '自增ID',  
user_id STRING COMMENT '用户ID',  
page_id STRING COMMENT '页面ID',  
visit_time TIMESTAMP COMMENT '访问时间',  
is_order INT COMMENT '是否下单(1是/0否)',  
create_time TIMESTAMP COMMENT '记录创建时间'  
) COMMENT 'DWD层无线端访问数据增量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

-- 4. DWD店内路径数据增量表  
CREATE TABLE IF NOT EXISTS gd.dwd_instore_path_flow_inc(  
id BIGINT COMMENT '自增ID',  
user_id STRING COMMENT '用户ID',  
source_page_id STRING COMMENT '来源页面ID',  
target_page_id STRING COMMENT '去向页面ID',  
jump_time TIMESTAMP COMMENT '跳转时间',  
create_time TIMESTAMP COMMENT '记录创建时间'  
) COMMENT 'DWD层店内路径数据增量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

-- 5. DWD PC端来源数据增量表  
CREATE TABLE IF NOT EXISTS gd.dwd_pc_source_base_inc(  
id BIGINT COMMENT '自增ID',  
user_id STRING COMMENT '用户ID',  
shop_id STRING COMMENT '店铺ID',  
source_page STRING COMMENT '来源页面URL',  
visit_time TIMESTAMP COMMENT '访问时间',  
create_time TIMESTAMP COMMENT '记录创建时间'  
) COMMENT 'DWD层PC端来源数据增量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

-- 6. DWD页面访问排行数据增量表  
CREATE TABLE IF NOT EXISTS gd.dwd_page_visit_rank_base_inc(  
id BIGINT COMMENT '自增ID',  
page_id STRING COMMENT '页面ID',  
stat_date DATE COMMENT '统计日期',  
visit_count BIGINT COMMENT '访问次数',  
create_time TIMESTAMP COMMENT '记录创建时间'  
) COMMENT 'DWD层页面访问排行数据增量表'  
PARTITIONED BY (ds STRING)  
STORED AS ORC  
TBLPROPERTIES (  
'orc.compress'='SNAPPY'
);

- ads层
    1. 无线端指标：

        - 入店页面访客数

        - 下单买家数

        - 转化率（下单买家数/访客数）

        - 各页面访问排行

    2. PC端指标：

        - 来源页面TOP20

        - 来源占比分析

        - 流量入口质量评估

    3. 店内路径指标：

        - 页面间跳转路径

        - 跳转次数统计

        - 路径转化率分析


***

#### 1. 流量 - 无线端数据

	1.1 无线端数据展示
    
    - 维度：按日 / 7 天 / 30 天 / 月，根据图片显示，我们要区分进店页面类型，共有三种类型（店铺页、商品详情页、店铺其他页）
        - 进店页面：展示无线端的进店页面
        - 访客数：对应进店页面的访客数量
        - 下单买家数：该进店页面带来的下单买家数量  
            select  
            date_type,  
            page_type,  
            page_name,  
            visitor_count,  
            buyer_count  
            from wireless_data  
            where date_type in ('day', '7days', '30days', 'month')
    
    1.2 页面访问排行展示
    
    - 维度：按访问的页面访客数，区分页面类型（店铺页、商品详情页、店铺其他页）
        - 店铺页：包括首页、活动页、分类页、宝贝页、新品页等
        - 商品详情页：商品的基础详情页面
        - 店铺其他页：订阅页、直播页等
        - 访问访客数：各页面的访问访客数量  
            select  
            page_type,  
            page_name,  
            visit_visitor_count  
            from page_rank_data  
            order by visit_visitor_count desc
    
    1.3 店内流转路径展示
    
    - 维度：访客在店内的流转涉及的页面
        - 来源页面：访客之前所在的页面
        - 去向页面：访客接下来前往的页面
        - 流转访客数：从来源页面到去向页面的访客数量  
            select  
            source_page,  
            target_page,  
            flow_visitor_count  
            from 店内_flow_data

#### 2. 流量 - PC 端数据

    2.1 流量入口展示
    
	展示 pc端访客的来源页面 TOP20和来源占比图
	
    - 维度：PC 端访客的来源页面
        - 来源页面：访客进入 PC 端的来源页面
        - 来源访客数：各来源页面的访客数量
        - 来源占比：各来源页面访客数占总访客数的比例（计算公式：来源访客数 / PC 端总访客数 ×100%）  
    select 
		source_page,
		source_visitor_count,
		(source_visitor_count / total_pc_visitor) * 100 as source_proportion
    from pc_traffic_entry
    order by source_visitor_count desc
    limit 20

	 2.2 页面访问排行

	 核心目标：按页面浏览量排序，展示进店页面的访客数、平均停留时长等数据。
    
    - 维度：页面类型（店铺页 / 商品详情页 / 店铺其他页）、页面名称
        - 浏览量：页面被浏览的总次数（排序依据）
        - 访客数：访问该页面的独立访客数量
        - 平均停留时长：访客在页面的平均停留时间（计算公式：总停留时长 / 访客数）
    select 
        page_type,
        page_name,
        page_views,
        visitor_count,
        avg_stay_duration
    from pc_page_rank
    order by page_views desc
    
	2.3 店内路径展示
	
	核心目标：呈现访客进店后在店内的流转路径。
    
    - 维度：来源页面、去向页面
        - 流转访客数：从来源页面跳转至去向页面的访客数量
        - 特殊说明：页面数据不做去重处理，可能出现来源/去向数据加总 > 总数据、来源≠去向的情况
	select 
	    source_page,
	    destination_page,
	    flow_visitor_count
	from pc_instore_path

优化脚本，添加多条数据，增加数据多样化
一个用户对应多个店铺id
一个用户对应多个页面
一个店铺对应多个商品