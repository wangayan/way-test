### 2025-08-14 日报


1. doris读取kafka数据

use bigdata_car_analysis_data_ws;

CREATE TABLE IF NOT EXISTS bigdata_car_analysis_data_ws.ods_mapping_kf_traffic_car_info_dtl (
id BIGINT,
msid VARCHAR(255),
datatype BIGINT,
data VARCHAR(255),
upexgmsgregister JSON,
vehicleno VARCHAR(255),
datalen BIGINT,
vehiclecolor BIGINT,
vec1 BIGINT,
vec2 BIGINT,
vec3 BIGINT,
encrypy BIGINT,
altitude BIGINT,
alarm JSON,
state JSON,
lon DOUBLE,
lat DOUBLE,
msgId BIGINT,
direction BIGINT,
dateTime VARCHAR(255),
ds DATE,
ts BIGINT
)
ENGINE=OLAP
DUPLICATE KEY(`id`)
PARTITION BY RANGE (ds)()
DISTRIBUTED BY HASH(`id`) BUCKETS 16
PROPERTIES (
"dynamic_partition.enable" = "true",
"dynamic_partition.time_unit" = "DAY",
"dynamic_partition.start" = "-180",
"dynamic_partition.end" = "30",
"dynamic_partition.prefix" = "p",
"dynamic_partition.buckets" = "16",
"dynamic_partition.create_history_partition" = "true",
"replication_num" = "3"
);


-- 停掉旧的 Routine Load（防止冲突）
STOP ROUTINE LOAD FOR bigdata_car_analysis_data_ws.ods_mapping_kf_traffic_car_info_dtl_load_v7;

-- 新建 Routine Load
CREATE ROUTINE LOAD bigdata_car_analysis_data_ws.ods_mapping_kf_traffic_car_info_dtl_load_v7
ON ods_mapping_kf_traffic_car_info_dtl
COLUMNS
(
id,
msid,
datatype,
data,
upexgmsgregister,
vehicleno,
datalen,
vehiclecolor,
vec1,
vec2,
vec3,
encrypy,
altitude,
alarm,
state,
lon,
lat,
msgId,
direction,
dateTime,
ds,
ts
)
PROPERTIES
(
"strict_mode" = "false",
"format" = "json",
"jsonpaths" = "[\"$.id\",\"$.msid\",\"$.datatype\",\"$.data\",\"$.upexgmsgregister\",\"$.vehicleno\",\"$.datalen\",\"$.vehiclecolor\",\"$.vec1\",\"$.vec2\",\"$.vec3\",\"$.encrypy\",\"$.altitude\",\"$.alarm\",\"$.state\",\"$.lon\",\"$.lat\",\"$.msgId\",\"$.direction\",\"$.dateTime\",\"$.ds\",\"$.ts\"]",
"strip_outer_array" = "false",
"max_batch_rows" = "200000",
"max_batch_interval" = "15"
)
FROM KAFKA
(
"kafka_broker_list" = "cdh01:9092,cdh02:9092,cdh03:9092",
"kafka_topic" = "realtime_v3_traffic_origin_data_info",
"property.group.id" = "doris_consumer_group_20250813_v6",
"kafka_default_offsets" = "OFFSET_EARLIEST"
);

SHOW ROUTINE LOAD;

SHOW BACKENDS;

select *
from ods_mapping_kf_traffic_car_info_dtl;



